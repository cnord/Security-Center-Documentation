# Транспортный файл. Руководство пользователя

## Что такое транспортный файл?

Это файл в формате .csv, с помощью которого можно, не заходя в «Центр охраны», изменить часть данных в одной или
нескольких карточках объекта. Транспортный файл можно создать вручную или автоматически выгрузить из программы, которая
 используется в организации. 

## Как выглядит транспортный файл?

Одна строка транспортного файла соответствует одной карточке объекта в «Центре охраны».

Все поля в строках имеют разделитель - точка с запятой. В «Центр охраны» передается только первые 6 полей строки. Остальные
поля игнорируются.
Каждому полю транспортного файла соответствует поле в карточке объекта «Центра охраны». Поэтому важно соблюдать порядок
полей при создании файла.

## Пример транспортного файла

Скриншот транспортного файла, который создан с помощью текстового редактора «Блокнот» в системе Windows.

с помощью такого файла можно изменить данные для двух карточек объекта с номерами 38 и 31

## Какие поля содержит транспортный файл?:

1 - Номер объекта
Только целое число. Например, 38 или 112
2 - Номер договора
Любое значение, которое не содержит точку с запятой. Потому что этот символ является разделителем в csv-файле. Например,
ДДУ-
3 - Баланс
Целые и десятичные числа, с разделителем - запятая. Возможно указать отрицательное значение. Например, 123,034 или -1200,
4 - Абонентская плата
Целые и десятичные числа с разделителем - запятая. Нельзя указать отрицательное значение. Например, 455,234 или 1200
5 - Дата списания
Дата в формате гггг-мм-дд. Например, 2018-11-
6 - Уровень информирования
Целое число из диапазона от -1 до 3. Например, -1 или 2. Числа вне этого диапазона не принимаются.
Обязательные поля: «Номер объекта» или «Номер договора».

При загрузке файла в «Центр охраны» значения запишутся в аналогичные поля карточки объекта в модуле «Менеджер объектов».
«Номер договора» и «Номер объекта» расположены на вкладке «Объект». «Баланс», «Абонентская плата», «Дата списания» и
«Уровень информирования» на вкладке «Охрана».
Значение поля «Уровень информирования» из транспортного файла влияет на переключатель в области «Услуги охраны» на
кладке «Охрана».


#### 1.

#### 2.

#### 3.

#### 4.

кладке «Охрана».
Описание того, как поля из транспортного файла отображаются в мобильном приложении клиентов, описано в статье MyAlarm:
Услуги охраны

## Что такое уровень информирования?

Значение уровня информирования (-1, 0, 1, 2 или 3)  в транспортном файле соответствует положению переключателя на вкладке
«Охрана» в области «Услуги охраны».

-1 Не отображать информацию в MyAlarm
0 Нет задолженности
1 Информировать о необходимости оплаты
2 Предупреждать о наличии задолженности
3 Запретить взятие под охраны и ограничить функции MyAlarm
Подробнее о том, как работает уровень информирования в статье MyAlarm: Услуги охраны

## Как создать транспортный файл?

Транспортный файл можно создать вручную с помощью текстового редактора, Excel или любой другой похожей программы.
Откройте текстовый редактор, например, «Блокнот»
Создайте новый файл
В строке перечислите через точку с запятой значения, которые хотите внести в карточку объекта
Сохраните файл в формате csv
Важно! При перечислении значений в строке, нужно точно соблюдать порядок полей. Поля в строке расположены в таком
порядке:

### 1 ; 2 ; 3 ; 4 ; 5 ; 6.

Если вы ошибетесь и внесете значение баланса (номер 3), в поле абонентской платы (номер 4), то клиент увидит в приложение
неверную информацию об абонентской плате. 
Транспортный файл может создаваться автоматически программой, которая используется в охранном предприятии для учета
данных, например, 1С. Настроить выгрузку транспортного файла может технический специалист, обслуживающий эту систему.

## Можно ли изменить только некоторые поля с помощью файла?

В транспортном файле можно указать значения только для части полей.
Номер объекта и номер договора - это идентификаторы объекта. Без них невозможно найти объект, чтобы внести в его карточку
данные. Поэтому хотя бы одно из этих трех полей должно быть заполнено обязательно.
Важно! Нельзя просто удалить лишние поля из транспортного файла. Пустые поля должны быть разделены точкой с запятой.

### Пример транспортного файла с частью данных


#### 1.

с помощью такого файла в карточку объекта загрузится только дата списания

## Как изменить значения в нескольких карточках объекта?

Если нужно изменить данные по нескольким объектам одновременно, создайте в файле соответствующее количество строк и для
каждой из них укажите свои значения.

## Как очистить поля в карточке объекта?

Если успеем до релиза это придумать, опишу как.
Если не успеем:
В этой версии с помощью транспортного файла очистить поля нельзя. Это возможно только вручную в карточке объекта.

## Как загрузить транспортный файл в Центр охраны?

В «Центр охраны» файл загружается автоматически с помощью службы «Центра охраны» C.Nord HTTP-API Service. Чтобы данные
из файла начали загружаться в «Центр охраны» автоматически, нужно сделать предварительные настройки, указав путь к файлу и
частоту проверки изменений в нем. 

## Как настроить службу CNord.WebApi.Service?

Параметры службы задаются в конфигурационном файле CNord.WebApi.Service.exe.config, расположенном в папке установки
«Центра охраны».
В большинстве случаев файл находится по пути: C:\Program Files (x86)\Andromeda\HttpApiService\CNord.WebApi.Service.exe.config
Чтобы изменить его содержимое, файл должен быть открыт от имени администратора.

В файле нужно сделать две настройки:

1. Частота проверки транспортного файла и загрузки его в «Центр охраны» 
Определяет в какие промежутке времени служба будет проверять файл и загружать его в «Центр охраны». 
Чтобы изменить параметр:
    Найдите в файле блок


#### 1.

#### 1.

```
Найдите в файле блок
```
### <setting name="TransportFileCheckInterval" serializeAs="String">

### <value>00:00:15</value>

 2. в тэге <value> укажите желаемое время проверки файла в формате чч:мм:сс. Минимальное значение - 10 секунд. 
2. Путь к транспортному файлу
с помощью этого параметра служба определяет где и какой файл выбрать для загрузки
Чтобы изменить параметр:
    найдите в файле блок

### <setting name="TransportFilePath" serializeAs="String">

### <value>C:\tf\transportfile.csv</value>

2. в тэге <value> укажите путь к файлу. Например, C:\tf\transportfile.csv

Важно! После настройки службы транспортный файл нужно положить в в папку, которую вы указали в конфигурационном файле.

## Что произойдет после настройки службы CNord.WebApi.Service?

Согласно настройкам в конфигурационном файле, служба проверит наличие файла по указанному адресу. Если транспортный
файл изменился с момента последней загрузки и все значения указаны правильно, данные из файла загрузятся в «Центр
охраны». 

### Как посмотреть результат загрузки файла?

Результат загрузки файла можно посмотреть в файле с логами, который находится по пути С:\Andromeda Log.
Файл создается автоматически. При создании ему присваивается имя в формате: apitf<дата создания>. Например, если
транспортный файл загружали 14 ноября 2018, то в папке «Andromeda Log» нужно найти файл с именем apitf2018-11-14.
Строки в файле логов сортируются от позднего к раннему, самые свежие строки находятся внизу списка.
Если транспортный файл не загрузился из-за ошибки, то она будет описана в строке файла с логами. Например, если служба не
смогла найти объект из транспортного файла, в логах появится описание ошибки:
2018-11-14 16:26:22.2080 ERROR [T:8] CNord.WebApi.TransportFile.TransportFileProcessor Ошибка в строке 2 файла: Объект не
найден. (код 104).



This is a offline tool, your data stays locally and is not send to any server!
Feedback & Bug Reports