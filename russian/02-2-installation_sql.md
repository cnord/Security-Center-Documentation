\pagebreak

# Установка и настройка SQL Server Express 2017 для работы с ПО «Центр охраны» {#install-mssql-instruction}

## Подготовка к установке

Перед установкой программного обеспечения «Центр охраны» необходимо проверить установлен ли какой-нибудь Microsoft SQL Server.

* Если установлен, то убедитесь, что имя экземпляра SQL отличается от «ANDROMEDA».
* Если SQL Server не установлен, то его нужно установить по нижеследующей инструкции.
Рекомендуется устанавливать Microsoft SQL Server 2017 или Microsoft SQL Server 2014.(параметры установки и настройки этих версий не различаются).

Установка Microsoft SQL Server Express будет состоять из следующих шагов:

1. Подготовка Windows. Отключение брандмауэра и антивируса.
2. Установка SQL Express.
3. Настройка SQL Server.

## Подготовка Windows

Рекомендуем устанавливать ПО «Центр Охраны» на лицензионную ОС Windows с последними официальными обновлениями. Желательно, чтобы система была «чистая», без лишнего ПО — это исключит проблемы с совместимостью и блокировками. Особенно, если уже установлен антивирус, файерволл и программы, работающие с SQL.

Разберем на примере Windows 7, как настроить систему перед запуском установки.

1. Пуск → Панель управления → Учётные записи пользователей → Изменение параметров контроля учётных записей → Передвинуть ползунок в нижнее положение.

\imgcapt{"setup SQL"/img_setup/2017/0.1.jpg}{}

2. Пуск → Панель управления → Система → Дополнительные параметры системы → Дополнительно → Быстродействие (параметры) → Предотвращение выполнения данных → выбрать «Включить DEP только для основных программ и служб Windows».

\imgcapt{"setup SQL"/img_setup/2017/0.2.jpg}{}

3. Пуск → Панель управления → Брандмауэр Windows → Включение и отключение брандмауэра Windows → выбрать «Отключить»

\imgcapt{"setup SQL"/img_setup/2017/0.3.jpg}{}

4. Выключите защиту антивирусного ПО, если оно установлено.

\pagebreak

## Установка SQL Express

### Где взять дистрибутив?

Для скачивания Microsoft SQL Server 2017 Express нужно перейти на ​[официальный сайт](https://www.microsoft.com/ru-RU/download/details.aspx?id=55994) компании Microsoft. Выбрать язык, на котором предполагается использование продукта, и нажать кнопку «скачать».

### Как установить?

1. Запустить установку Microsoft SQL Server 2017 Express от имени администратора.

\imgcapt{"setup SQL"/img_setup/2017/1.png}{}

2. Выберите «Пользовательский» тип установки.   
Начальные этапы программы установки выполняются на языке операционной системы.

\imgcapt{"setup SQL"/img_setup/2017/1.1.png}{}

3. Необходимо выбрать язык SQL Server. Выбрать папку для установки. Нажать кнопку «Установить».

\imgcapt{"setup SQL"/img_setup/2017/1.2.png}{}

4. Подождите, пока скачается все необходимое. Выберите верхний пункт «Новая установка...»:

\imgcapt{"setup SQL"/img_setup/2017/1.3.png}{}

5. Установите галку принятия условий и нажмите «Далее»:

\imgcapt{"setup SQL"/img_setup/2017/1.4.png}{}
Если при установке экземпляра SQL появится ошибка обновления, нажмите «Далее».

6. Нажимайте «Далее», пока не появится окно «Выбор компонентов». Оставьте галки, как на скриншоте, и нажмите «Далее»:

\imgcapt{"setup SQL"/img_setup/2017/1.5.png}{}

7. Выберите «Именованный экземпляр». Задайте ANDROMEDA и нажмите «Далее»:

\imgcapt{"setup SQL"/img_setup/2017/1.6.png}{}

8.  Для служб «Ядро СУБД SQL Server» и «Обозреватель SQL Server» установите «Тип запуска» — Авто:

\imgcapt{"setup SQL"/img_setup/2017/1.7.png}{}

9.  Для службы «Ядро СУБД SQL Server» в поле «Имя учетной записи» выберите Обзор. В открывшемся окне нажмите «Дополнительно». И в новом окне — Поиск. В открывшемся списке выберите NETWORK SERVICE и нажмите дважды OK, затем «Далее»:

\imgcapt{"setup SQL"/img_setup/2017/1.8.png}{}

10. Установите «Смешанный режим». Введите пароль (в последних версиях SQL нужно использовать пароль с буквами, в том числе заглавными и цифрами):

\imgcapt{"setup SQL"/img_setup/2017/1.9.png}{}

11. Дождитесь завершения установки и нажмите Закрыть:

\imgcapt{"setup SQL"/img_setup/2017/1.10.png}{}

\pagebreak

## Настройка SQL Server

Для настройки SQL Server нужно выполнить следующие действия:

1.  Запустите «Диспетчер конфигурации SQL Server 2017» (удобно запускать через поиск по "sql"):

\imgcapt{"setup SQL"/img_setup/2017/1.11.png}{}

2.  В «Сетевой конфигурации SQL Server» выберите «Протоколы для ANDROMEDA». Двойным кликом откройте «Именованные каналы» и выберите «Включено» - «Да». Нажмите ОК:

\imgcapt{"setup SQL"/img_setup/2017/1.12.png}{}

3. Аналогично выберите «Включено» — «Да» для TCP/IP:

\imgcapt{"setup SQL"/img_setup/2017/1.13.png}{}

4. Оставаясь в свойствах TCP/IP перейдите на вкладку «IP-адреса». В самом низу в IPAll укажите TCP-порт — 1433, Динамические TCP-порты — пусто. Нажмите ОК:

\imgcapt{"setup SQL"/img_setup/2017/1.14.png}{}

5. Выберите «Службы SQL Server». Правой кнопкой по «SQL Server (ANDROMEDA)» откройте меню и и нажмите Перезапустить:

\imgcapt{"setup SQL"/img_setup/2017/1.15.png}{}

Установка и настройка завершена, можно приступать к установке Центра Охраны.

## Дополнительно

Если работа ПО «Центр охраны» или его сетевого места предполагается на ПК с операционной системой Windows XP или Microsoft SQL Server 2008, то дополнительно нужно сделать
следующие действия:

1. Перед началом установки ПО «Центр охраны» ​скачать с официального сайта​ и установить SQL Server Native Client: sqlncli.msi

\imgcapt{"setup SQL"/img_setup/2017/20.jpg}{}

2. После установки клиента, установите сетевое рабочее место ПО «Центр охраны».
3. На пк, где установлено сетевое место «Центра охраны», открыть файл Andromeda.ini (обычно он располагается по этому пути: C:\\Program Files (x86)\\Andromeda).
4. Заменить строку ​ _Provider=SQLNCLI11_ ​ на строку​ _Provider=SQLNCLI10._
5. Сохранить. Перезапустить сетевое место «Центра охраны».

