# Менеджер событий

Модуль «Менеджер событий» предназначен для приема извещений от приемного оборудования центральной станции, а также напрямую от некоторых видов объектового оборудования, например, по каналам связи GPRS и Ethernet.

Результатом обработки принятых извещений модулем «Менеджер событий» являются события, которые и составляют основу работы «Центра охраны».

В «Менеджере событий» происходит автоматизированная обработка событий: контроль цепочек событий, отправка SMS-сообщений и передача событий в другие системы.
Кроме того, «Менеджер событий» является связующим звеном для всех остальных модулей «Центра охраны»: он должен быть запущен первым, так как именно с его помощью модули обмениваются информацией о новых событиях, действиях операторов и других изменениях, произошедших при работе модулей.

После запуска модуля в системной области панели задач Windows появляется иконка, информирующая о работе модуля. При приеме любого события цвет иконки меняется, а по наведению курсора мыши появляется информация о времени последнего события и общем количестве событий с момента запуска модуля.

Нажатие правой кнопки мыши на иконке модуля приводит к появлению меню. 

## Настройки модуля

Доступ к настройкам можно получить, если выбрать пункт «Настройка...» в меню модуля.

Параметр «__Периодичность тревог расписания охраны__» задает интервал генерации системных событий с кодами ZZXB и ZZXC. Системные события с этими кодами создаются при нарушении расписания ежедневной охраны объекта и нарушении длительной охраны объекта соответственно. Настройка расписания охраны, как и настройка длительной охраны объекта, осуществляется индивидуально для каждого объекта в модуле «Менеджер объектов».

Параметр «__Интервал фильтрации повторных событий__» задает интервал, в течении которого второе и последующие одинаковые события, полученные по разным каналам связи, будут считаться повторными. Повторные события обрабатываются в модулях «Центра охраны» специальным образом. Так, в модуле «Дежурный оператор» они не отображаются в общем списке принятых событий. При этом можно включить их отображение на закладке событий от объекта. Кроме того, повторные события не включаются в отчеты, если специально не указана такая необходимость. Рекомендуемое значение для этого параметра — 60 секунд.

__Фильтрацию тестовых событий__ можно отключить с помощью одноименного параметра. При включенной фильтрации тестовые события обрабатываются так же, как и повторные: они не отображаются в модуле «Дежурный оператор» и отчетах по событиям. 

Необходимо понимать, что повторные и тестовые события составляют от 75 до 95 процентов от общего числа принятых «Центром охраны» событий. Как следствие, механизм фильтрации повторных и тестовых событий позволяет освободить операторов «Центра охраны» от необходимости обрабатывать информацию, не имеющую полезного значения. По этой же причине, фильтрация событий положительно сказывается на производительности модулей «Центра охраны». Не рекомендуется отключать фильтрацию повторных и тестовых событий без веских на то оснований. 

### Резервное копирование

Вкладка «Резервное копирование» окна настроек модуля «Менеджер событий» предназначена для управления заданиями резервного копирования. 

Различаются два типа резервных копий базы данных «Центра охраны»: оперативная и полная. 

* _Полная_ копия базы данных содержит всю информацию, хранящуюся в базе данных на момент копирования, включая полученные события, действия операторов и отправленные SMS-сообщения за все время эксплуатации программного обеспечения.

* Объем данных в оперативной копии значительно меньше: в ней сохраняются события, действия операторов и SMS-сообщения только за последний месяц.

В общем случае, для заданий резервного копирования рекомендуется использовать оперативное копирование. Полное резервное копирование рекомендуется выполнять вручную или с помощью заданий планировщика Windows.

Для каждого задания резервного копирования можно указать несколько __папок назначения__: после того, как резервная копия данных будет создана, она будет скопирована в каждую из указанных папок. При этом будет контролироваться количество файлов резервной копии базы данных «Центра охраны» в каждой папке назначения. Если при создании резервной копии будет обнаружено, что количество файлов резервных копий больше, чем задано параметром «Количество файлов в папке назначения», то самый старый по времени файл резервной копии будет удален.

Кроме __интервала резервного копирования__, который задает периодичность выполнения задания резервного копирования, можно указать __время начала выполнения задания__. Таким образом, можно организовать резервное копирование раз в сутки, либо запускать периодическое резервное копирование каждый день в одно и то же время.

Больше о заданиях резервного копирования можно узнать из соответствующего раздела описания модуля «Мастер базы данных», одним из назначений которого как раз и является создание резервных копий базы данных «Центра охраны».

## Источники событий

Основное назначение модуля «Менеджер событий» заключается в том, что он осуществляет прием извещений от приемного оборудования центральной станции, а также напрямую от некоторых видов объектового оборудования, например, по каналам связи GPRS и Ethernet. Разнообразие способов и протоколов передачи извещений поддерживается с помощью специальных компонентов модуля «Менеджер событий», которые называются источниками событий.

Доступ к настройкам источников событий можно получить, если выбрать пункт «Источники событий...» в меню модуля.

Программное обеспечение «Центр охраны» версии 3.4 содержит в своем составе следующие источники событий.

### Источник событий от PimaGuard

Предназначен для приема событий по последовательному порту или сети Ethernet от программного обеспечения «Mcard для MS-DOS», «Pima NetSoft» и «PimaGuard для Windows» в протоколе «Andromeda».
Наиболее современный источник для приема событий от приемного оборудования центральной станции производства фирмы Pima. Если необходима поддержка новейших возможностей приемного оборудования центральной станции, а также протоколов и каналов передачи извещений, необходимо использовать именно этот источник событий.

При использовании источника от PimaGuard в режиме приема событий по сети Ethernet, рекомендуется использовать отдельный экземпляр источника событий для каждого экземпляра передающего программного обеспечения.

### Источник событий по TCP/IP

Предназначен для приема событий по сети, поддерживающей протокол TCP/IP, от следующего оборудования производства фирмы «Си-Норд»:

* GSM-передатчики ТР-100GSM и ТР-100GSM II — по каналу GPRS
* кнопка тревожной сигнализации «Кнопка» — по каналу GPRS
* ретранслятор «Цефей» — по каналу Ethernet

При использовании этого источника событий, как правило, требуется выделенный IP-адрес в сети интернет. Кроме того, рекомендуется разные типы оборудования подключать к разным экземплярам источника событий, а при подключении ретранслятора «Цефей» лучше всего использовать отдельный экземпляр источника событий для каждого ретранслятора.

### Источник событий от программного обеспечения «GuardBox»

Предназначен для приема событий по последовательному порту от программного обеспечения «GuardBox».
Использование этого источника событий гарантирует передачу событий от приемного оборудования центральной станции. Кроме того, он обеспечивает целый ряд других функций, например, синхронизацию времени с компьютером центральной станции.

### Источник событий по GSM

Предназначен для приема событий по SMS и CSD-каналам GSM от следующего оборудования:

* кнопка тревожной сигнализации «PT-300» производства фирмы GemTek — по каналу SMS
* кнопка тревожной сигнализации «Кнопка» производства фирмы «Си-Норд» — по каналу CSD

Необходимо отметить, что для использования источника событий по GSM нужно подключить к компьютеру GSM-модем SonyEricsson GT-47, Siemens MC35, либо совместимый с ними по системе команд.

### Источник событий от Sur-Gard

Предназначен для приема событий по последовательному порту от приемного оборудования центральных станций Sur-Gard производства фирмы DSC вплоть до System III включительно. 
Поскольку формат передачи данных, используемый центральными станциями Sur-Gard, фактически является стандартом, этот источник событий может использоваться для приема событий от оборудования и программного обеспечения самых разных производителей: «Ритм», «Проксима», Jablotron и других. 

### Источник событий от LONTA-202

Предназначен для приема событий по последовательному порту от пультов централизованного наблюдения Lonta PRO, Lonta Optima и LONTA-202 производства фирмы «Альтоника». 

Необходимо отметить, что если вы используете программное обеспечение «Страж» вместе с любым пультом производства фирмы «Альтоника» и хотите перейти на программное обеспечение «Центр охраны», то вам нужно знать о возможности выполнить автоматический импорт данных из программного обеспечения «Страж». Подробнее об этой функции можно узнать из описания модуля «Мастер базы данных», с помощью которого и осуществляется импорт данных.

### Источник событий от RS-200

Предназначен для приема событий от пульта централизованного наблюдения RS-200 производства фирмы «Альтоника». Необходимо отметить, что источник событий поддерживает весь спектр оборудования, передающего сигналы на пульт RS-200.

### Источник событий от АНД ПС-512 или ББЦС-12

Предназначен для приема событий по последовательному порту от пультов централизованного наблюдения «АНД ПС-512» (Малый пульт) или «ББЦС-12» производства фирмы «Си-Норд».

### Источник событий ББЦС Евро

Предназначен для приема событий по последовательному порту от пульта централизованного наблюдения «ББЦС Евро» производства фирмы «Си-Норд».

### Источник событий от панелей «Норд LAN»

Предназначен для приема событий по сети, поддерживающей протокол TCP/IP, от панелей «Норд LAN», производства фирмы «Си-Норд». 
Этот источник событий поддерживает отправку управляющих команд для перепрограммирования списка ТМ-ключей в памяти панели «Норд LAN», но сами команды формируются в модуле «Конфигуратор ключей», который входит в состав программного обеспечения «Центр охраны».

### Источник событий от RC4000

Предназначен для приема событий по последовательному порту от пульта централизованного наблюдения RC4000 производства фирмы Visonic. 

Если вы используете пульт RC4000 вместе с программным обеспечением CSM32 и хотите перейти на программное обеспечение «Центр охраны», то вам нужно знать, что есть возможность выполнить автоматический импорт данных из программного обеспечения CSM32. Подробнее об этой функции можно узнать из описания модуля «Мастер базы данных», с помощью которого и осуществляется импорт данных.

### Источник событий «Мультипротокол»

Предназначен для приема событий по последовательному порту от пульта централизованного наблюдения Silent Knight 9500 (производства фирмы Honeywell) и пультов RCI4000/RCI5000/DTRCI5000 (производства фирмы KP Electronics). Кроме того, этот источник событий поддерживает прием данных в некоторых других распространенных протоколах, например, в протоколе Ademco 685.

### Настройки источников событий

Если источник событий предназначен для приема данных по последовательному порту, то необходимо выбрать порт, к которому подключено оборудование центральной станции, и указать его параметры (скорость, четность, количество бит данных и так далее).

Если источник событий предназначен для приема данных по сети, поддерживающей протокол TCP/IP, то в качестве параметров источника необходимо будет указать сетевой интерфейс и порт, на котором источник будет ожидать приема входящих подключений.

«__Внутренний номер__» источника событий необходим для идентификации его как «Центром охраны», так и пользователем. Во-первых, номер источника событий используется для определения того, от какого источника получено то или иное событие. Во-вторых, в том случае, когда источник событий что-то сообщает пользователю, создаваемое им для этого событие будет иметь такой же номер объекта, как и внутренний номер компонента. 
Настоятельно рекомендуется создавать в «Центре охраны» объекты, номера которых соответствуют внутренним номерам используемых источников событий — это позволит контролировать возникновение ошибок, возникающих при работе источников событий, а также получать служебную информацию о работе источников.

Параметр «__Контрольное время источника событий__» позволяет автоматически отслеживать факт приема событий источником и информировать оператора о проблемах, возникших при приеме. В случае, если по какой-то причине за заданный этим параметром интервал источником событий не будет принято ни одного события, будет создано системное событие с кодом «ZZXH» и номером объекта, соответствующим внутреннему номеру источника событий.

С помощью «__Сдвига номеров объектов__» можно задать целое положительное слагаемое, которое автоматически будет добавляться к номеру объекта для каждого события, принятого источником событий. 
Сдвиг номеров объектов рекомендуется использовать в том случае, если к одному экземпляру программного обеспечения «Центр охраны» нужно подключить несколько пультов централизованного наблюдения, в том числе — разных пультов. Задавая для разных источников событий разные сдвиги номеров объектов, можно избежать проблемы с наложением одинаковых номеров разных объектов, работающих на разные пульты.

Например, к «Центру охраны» подключено два пульта Lonta-202. Диапазоны номеров объектов, которые могут быть подключены к пультам, одинаковы — от 1 до 600. Но если задать для одного источника событий сдвиг номеров объектов равный 1000, а для другого — 2000, то внутри «Центра охраны» мы будем работать с объектами 1001-1600 для одного пульта и 2001-2600 — для другого.

__Сдвиг номера канала__ - это параметр, задающий целое положительное слагаемое, которое автоматически будет добавляться к номеру канала приема. 
Если задано нулевое значение сдвига номера канала, то для событий, принятых источником событий будет использоваться номер канала, передаваемый приемным оборудованием центральной станции или первый номер канала, если оборудование номер канала не передает.
Задавая для разных источников событий разные сдвиги номеров каналов, можно различать источники событий (и подключенные к ним пульты) для принятых событий.
Сдвиг номера канала особенно актуален при использовании нескольких одинаковых источников событий, так как типы и номера каналов связи, используемые этими источниками, наверняка будут совпадать. 

«__Тип канала приема__» и «__Номер канала приема__» позволяют явно указать соответствующие им по значению параметры в том случае, если определить их однозначно не представляется возможным. Например, «Источник событий по сети TCP/IP» может осуществлять прием событий как от передатчиков ТР-100GSM по каналу GPRS, так и от ретрансляторов «Цефей» по каналу Ethernet. Идентифицировать канал связи, который используется при передаче, источник событий не может. Поэтому при настройке этого источника событий необходимо явно указать тип канала связи, который используется при передаче (GPRS, если источник предназначен для приема событий от ТР-100GSM и Ethernet, если источник принимает данные от «Цефея»). Кроме того, если используется несколько таких источников событий, то чтобы различать каким источником принято событие, необходимо задать для них разные номера каналов приема.

Параметр «__Интервал переинициализации__» позволяет принудительно выполнять переинициализацию подключенного к источнику событий оборудования, например, GSM-модема.

С помощью функции «__Протоколирования обмена__» можно сохранить на жесткий диск протокол обмена источника событий с приемным оборудованием центральной станции или контрольной панелью. Эта информация бывает нужной при выяснении причин возникновения проблем в обмене. Не рекомендуется включать протоколирование обмена самостоятельно, без запроса из службы технической поддержки ООО НТКФ «Си-Норд».

## Обработчики событий

После того, как модуль «Менеджер событий» примет извещение от пульта централизованного наблюдения или контрольной панели, он выполняет его расшифровку и описание в соответствии с шаблоном событий, заданным для объекта, от которого получено извещение. Полученное в результате расшифровки извещения событие может быть автоматически обработано в модуле «Менеджер событий» с помощью специальных компонентов модуля, которые называются обработчиками событий.
В комплекте с программным обеспечением «Центр охраны» версии 3.4 поставляются следующие обработчики событий:

### Контроль события

Данный обработчик осуществляет контроль периодического получения события заданного класса и генерацию системного события в случае его отсутствия.
Обработчик может применяться для решения следующих задач:

* «Контроль охранника». Задача контроля охранника зачастую сводится к простому контролю периодического получения заданного события. При этом, несмотря на то, что последовательность приема событий не контролируется, можно осуществлять контроль охранников даже на сложном маршруте за счет подбора интервалов получения событий.
* «Контроль автоматических тестов». В отличие от контрольного времени объекта, подразумевающего приход любого события с объекта по любому каналу связи, можно контролировать периодический приход конкретного события, причем указать канал связи, по которому должно быть принято это событие.

### Контроль цепочки событий

Этот обработчик предназначен для контроля временной последовательности (цепочки) принимаемых событий и генерацию системных сообщений в случае ее нарушения.
Обработчик предназначен для решения таких задач, как:

* «Контроль парных событий». Например, контроль восстановления 220В или других неисправностей на объекте. Используя обработчик «Контроль цепочки событий» можно автоматически отличать кратковременные неисправности от фатальных, например, выявлять объекты, на которых электропитание отсутствует слишком долго.
* «Контроль охранника». Применение этого обработчика позволяет контролировать движение охранника по маршруту с учетом правильной последовательности обхода.

### Вход через тревогу

Обработчик событий «Вход через тревогу» позволяет приостановить обработку тревожного события модулем «Менеджер событий» и подождать снятия с охраны, которое может быть получено непосредственно после тревоги.

Назначение этого обработчика событий — избавить дежурного оператора от необходимости реагировать на заведомо ложные тревоги, происходящие при снятии объектов с охраны.

Данный обработчик должен применяться для тех объектов, где используется тактика охраны, исключающая задержку на вход. Кроме того, использование этого обработчика оправдано для всех объектов, где возможна ошибка персонала при выполнении снятия с охраны.

### Ретранслятор SMS

Этот обработчик позволяет организовать передачу информации о принятых событиях на мобильный телефон в виде SMS-сообщений.

Для отправки SMS-сообщений обработчик может использовать GSM-модем, который нужно подключить к компьютеру или прямое подключение к SMS-серверу оператора сотовой связи по сети TCP/IP.

С помощью обработчика «Ретранслятор SMS» можно оказывать дополнительную услугу клиентам охранного предприятия, например, информируя ответственных лиц о постановках и снятиях объекта с охраны.
Кроме того, с помощью этого обработчика можно передавать тревоги непосредственно на мобильный телефон ГБР параллельно работе дежурного оператора.

Также использование этого обработчика может существенно облегчить пусконаладку оборудования на подключаемых объектах. Если инженеру выделить персональный номер объекта, который он должен использовать при проверке работы оборудования на объекте, и включить SMS-ретрансляцию событий, полученных с этого объекта на его мобильный телефон, то это позволит ему выполнять настройку оборудования, не прибегая к помощи дежурных операторов пульта.

### Сеть Пандоры

Основная задача обработчика событий «Сеть Пандоры» это организация обмена информацией между независимыми экземплярами программного обеспечения «Центр охраны». От одного «Центра охраны» в другой могут быть переданы события, действия операторов и описания объектов.

В качестве канала передачи информации можно использовать любой канал, поддерживающий протокол TCP/IP. 

В настройках обработчика событий предусмотрена возможность точно описать объем информации, которая будет передаваться. Например, можно указать номера и интервалы номеров объектов, события от которых будут переданы, указать классы событий, необходимые к передаче, выбрать действия операторов, которые нужно передавать. Возможна взаимная (встречная) передача информации.

В первую очередь обработчик событий применяется при создании распределенных систем мониторинга — когда несколько пультов централизованного наблюдения объединяются и необходимо собрать оперативную информацию в некотором едином диспетчерском центре.

### ШПИ ПАК «Стрелец-Мониторинг»

Назначением этого обработчика событий является передача событий и информации об объектах в программное обеспечение программно-аппаратного комплекса «Стрелец-Мониторинг», используемого в целом ряде подразделений МЧС России. 

Для того чтобы передать операторам системы «Стрелец-Мониторинг» всю информацию, необходимую для 
создания объектов «Центра охраны», необходимо воспользоваться специальным отчетом по объектам («10 — Объекты с GUID (для Стрельца)»), который можно создать в модуле «Менеджер отчетов».

Возможность использования обработчика «ШПИ ПАК «Стрелец-Мониторинг» совместно с программным обеспечением «Стрелец-Мониторинг» подтверждена фирмой «Аргус-Спектр», которая является производителем программно-аппаратного комплекса «Стрелец-Мониторинг».

