# Проверка КТС

## Начать проверку КТС (/api/CheckPanic/start) {#api-checkpanic-start}

Метод предназначен для запуска процедуры проверки КТС.

**URL** : `/api/CheckPanic/start`

**Метод** : `POST`

**Требуется ApiKey** : да

### Параметры

#### siteId

Идентификатор объекта, по которому нужно проверить КТС. Обязательный параметр.

#### userName

Имя пользователя, от имени которого выполняется операция. Необязательный параметр.

### Возможные статусы ответов

`200`, `403` – cм. «[Статусы ответов](#api-status-codes)».

### Возвращаемый результат

Результат проверки - в теле ответа, тип – `application/json`

```json
{
"Status": 200,
"Description": "string",
"CheckPanicId": "string"
}
```

#### Status

Результат выполнения запроса, всегда равен 200.

#### Description

Результат запуска процедуры проверки КТС.

Возможные значения:

- `"has alarm"` – по объекту есть тревога, проверка КТС запрещена;
- `"already run"` – по объекту уже выполняется проверка КТС;
- `"success"` – проверка КТС начата;
- `"error"` - при выполнении запроса произошла ошибка.

#### CheckPanicId

Идентификатор запущенной процедуры проверки КТС. Значение идентификатора необходимо использовать в качестве аргумента при вызове метода [`/api/CheckPanic/result`](#api-checkpanic-result).

### Пример использования

```bash
curl -X POST --header 'Accept: application/json' --header 'apiKey: 41c66fd22dcf4742b65e9f5ea5ebde1c' `
`'http://10.7.22.145:9002/api/CheckPanic/start?siteId=ae59ad78-6341-44dc-adb8-4803b7f02412&`
`userName=automatic_panic_checker'
```

```json
{
    "Status": 200,
    "Description": "success",
    "CheckPanicId": "5b42d9f1-52f3-4144-9a4f-bd047c60e115"
}
```

## Получить результат проверки КТС (/api/CheckPanic/result) {#api-checkpanic-result}

Метод предназначен для получения результата процедуры проверки КТС.

**URL** : `/api/CheckPanic/result`

**Метод** : `GET`

**Требуется ApiKey** : да

### Параметры

#### checkPanicId

Идентификатор процеудры проверки, для которой нужно получить результат. Идентификатор возвращается в результате вызова метода [`/api/CheckPanic/start`](#api-checkpanic-start).

#### userName

Имя пользователя, от имени которого выполняется операция. Необязательный параметр.

### Возможные статусы ответов

`200`, `403` – cм. «[Статусы ответов](#api-status-codes)».

### Возвращаемые результаты

Результат проверки - в теле ответа, тип – `application/json`

```json
{
    "Status": 200,
    "Description": "string"
}
```

#### Status

Результат выполнения запроса, всегда равен 200.

#### Description

Результат выполнения процедуры проверки КТС.

Возможные значения:

- `"not found"` – проверка с указанным идентификатором не найдена;
- `"in progress"` – проверка с указанным идентификатором продолжается (не завершена): КТС не получена, тайм-аут не истек;
- `"success"` – проверка с указанным идентификатором успешно завершена;
- `"time out"` – проверка с указанным идентификатором завершена с ошибкой: истек интервал ожидания события КТС;
- `"error"` - при выполнении запроса произошла ошибка.

> Примечание: метод возвращает значения `Description` равные `"success"` или `"time out"` только один раз: следующий вызов метода `/api/CheckPanic/result` с тем же значением параметра `checkPanicId` вернет значение парааметра `Description` равным `"not found"`.

### Пример использования

```bash
curl -X GET --header 'Accept: application/json' --header 'apiKey: 41c66fd22dcf4742b65e9f5ea5ebde1c' `
`'http://10.7.22.145:9002/api/CheckPanic/result?checkPanicId=5b42d9f1-52f3-4144-9a4f-bd047c60e115&`
`userName=automatic_panic_checker'
```

```json
{
    "Status": 200,
    "Description": "in progress",
}
```
